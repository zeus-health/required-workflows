name: cost-allocation-tags

on:
  pull_request:
    branches: [main]

permissions:
  actions: read
  contents: read
  packages: read
  pull-requests: read
  repository-projects: read

jobs:
   cost-allocation-check:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/zeus-health/ci-worker
      credentials:
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Checkout
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.REQ_WORKFLOW_PAT }}
          repository: zeus-health/required-workflows
          ref: feature/INFR-648-deafult_tags
          path: required-workflows
          set-safe-directory: 'cost_allocation_tags'
      - name: Check for AWS cost allocation tags
        shell: bash
        env:
          READ_ONLY_GITHUB_TOKEN: ${{ secrets.READ_ONLY_GITHUB_TOKEN }}
        run: |
          ./required-workflows/cost_allocation_tags/main.sh
